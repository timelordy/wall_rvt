# Wall Layer Splitter — расширение pyRevit

Расширение pyRevit **Wall Layer Splitter** переносит логику одноимённой C#-команды
на Python. Инструмент разбивает выбранные многослойные стены на отдельные стены,
соответствующие каждому слою исходной конструкции. Скрипт автоматически
дублирует типы стен, переносит базовые параметры и пытается перепривязать
семейства, которые были размещены на исходной стене.

## Структура репозитория

```
pyrevit/
  extension/
    WallLayerSplitter.extension/
      lib/               # Общие модули для расширения (логгер и т. п.)
      WallLayerSplitter.tab/
        Wall Tools.panel/
          SplitLayers.pushbutton/
            bundle.yaml  # Конфигурация кнопки
            script.py    # Основная логика разделения стен
```

## Требования

* **Autodesk Revit** 2020 или новее.
* **pyRevit** 5.0+ с поддержкой Python 3.
* Права на установку расширений pyRevit (локально или в общем профиле).
* Для разработки: установленный `pythonnet` (входит в поставку pyRevit) и,
  при желании, линтер `ruff` для статической проверки кода.

## Установка расширения

1. Клонируйте репозиторий или скачайте архив.
   ```bash
   git clone https://github.com/<your_org>/wall_rvt.git
   ```
2. Добавьте расширение в pyRevit одним из способов:
   * через CLI pyRevit:
     ```bash
     pyrevit extensions add WallLayerSplitter "<путь_к_репозиторию>/pyrevit/extension/WallLayerSplitter.extension"
     ```
   * либо создайте символическую ссылку в директории расширений pyRevit:
     ```bash
     mklink /D "%APPDATA%\pyRevit\Extensions\WallLayerSplitter.extension" "<путь_к_репозиторию>\pyrevit\extension\WallLayerSplitter.extension"
     ```
3. Перезапустите Revit или выполните `pyrevit reload`, чтобы подтянуть новое расширение.

После подключения в ленте pyRevit появится вкладка **WallLayerSplitter** → панель
**Wall Tools** с кнопкой **Разбить слои**.

## Использование

1. Откройте модель Revit и убедитесь, что на вкладке pyRevit видна панель **Wall Tools**.
2. Выберите одну или несколько многослойных стен. Если выделение пустое,
   команда попросит указать стены вручную.
3. Нажмите кнопку **Разбить слои**. Скрипт выполнит следующие действия:
   * создаст дубликаты типов стен под каждый слой, сохранив материалы и толщины;
   * построит новые стены вдоль базовой линии исходной стены с нужными смещениями;
   * перенесёт основные параметры (смещения, высоту, отметки и т. п.);
   * временно отвяжет и затем перепривяжет семейства, размещённые на стене;
   * удалит исходную стену, если это не нарушает зависимые элементы.
4. По окончании появится диалог с результатами (сколько стен создано, какие
   семейства перепривязаны, что не удалось обработать).

Диагностические сообщения выводятся в окно pyRevit (панель Output).

## Ручное тестирование

Рекомендуемые сценарии проверки после установки:

* **Стены с разным числом слоёв.** Убедитесь, что создаются нужные типы и
  геометрия совпадает.
* **Стены с закреплёнными семействами.** Проверьте, что семейства временно
  отвязываются и возвращаются на подходящий слой.
* **Стены в рабочих наборах и дизайн-опциях.** Команда должна корректно
  выявлять ограничения и выводить уведомления, если удалить стену нельзя.
* **Стены с различной привязкой (по центру, по грани).** Отступы новых стен
  должны повторять исходную привязку.
* **Виды с отличающимися фазами.** Проверить, что команда не нарушает фазовую
  принадлежность и предупреждает о несоответствиях.

## Разработка и вклад

* Весь Python-код хранится в каталоге `pyrevit/extension`.
* Общие вспомогательные функции размещаются в `lib/` (например, `logger.py`).
* Для проверки стиля рекомендуется использовать [ruff](https://github.com/astral-sh/ruff):
  ```bash
  pip install ruff
  ruff check .
  ```
* Перед отправкой изменений протестируйте расширение в Revit на примерах,
  описанных выше.

## История изменений

* 2024-xx-xx — перенос логики C#-решения на pyRevit, добавление структуры
  расширения и модуля логирования.

## Лицензия

Проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).
